# 审核流程使用指南

## 功能概述

当合作导师审核通过学生申请时，系统会自动更新多个页面的状态：

1. **合作导师首页表格**：流程状态改为"审核通过"，并移动到"已处理"列表
2. **进站申请页面**：动态更新"流程状态"、"节点名称"、"当前审批结果"
3. **流程图**：合作导师状态变为"已完成"
4. **博士后页面**：相关审核状态同步更新

## 审核流程状态说明

### 状态流转
```
未提交 → 导师未审核 → 导师驳回/学院未审核 → 学院驳回/已审核
```

### 状态对应关系

| Workflow状态 | 显示状态 | 说明 |
|-------------|----------|------|
| 未提交 | 未提交 | 学生尚未提交申请 |
| 导师未审核 | 等待导师审核 | 学生已提交，等待导师审核 |
| 导师驳回 | 导师审核不通过 | 导师审核驳回 |
| 学院未审核 | 等待学院审核 | 导师通过，等待学院审核 |
| 学院驳回 | 学院审核不通过 | 学院审核驳回 |
| 已审核 | 审核结束 | 整个流程完成 |

## 使用步骤

### 1. 导师登录
- 使用导师账号登录系统
- 进入"进站管理"页面

### 2. 查看待审核申请
- 在"待处理"标签页查看需要审核的申请
- 点击"查看"按钮进入详情页面

### 3. 进行审核
- 在详情页面点击"审核通过"或"审核不通过"
- 系统会自动更新workflow状态

### 4. 查看结果
- 审核通过后，申请会从"待处理"移动到"已处理"
- 状态显示为"审核通过"
- 流程图中的合作导师状态变为"已完成"

## API接口说明

### 审核接口
```
PUT /api/entryMange/teacher/student/{user_id}/approve
```

**请求参数**：
```json
{
  "approved": true,  // true: 通过, false: 驳回
  "comment": "审核意见"
}
```

**响应示例**：
```json
{
  "message": "审核通过，已提交学院审核",
  "approved": true,
  "user_id": 1,
  "student_name": "张三",
  "workflow_status": "学院未审核",
  "updated_at": "2025-01-20T10:30:00"
}
```

### 获取学生列表接口
```
GET /api/entryMange/teacher/students
```

**响应示例**：
```json
[
  {
    "id": 1,
    "studentId": "2025001",
    "name": "张三",
    "college": "园艺林学院",
    "major": "林学",
    "applyTime": "2025-01-20",
    "status": "审核通过",
    "node": "学院",
    "currentApproval": "学院审核（待处理）",
    "workflow_status": "学院未审核",
    "steps": [
      {
        "status": "已完成",
        "role": "学生申请",
        "time": "2025-01-20 10:00:00"
      },
      {
        "status": "已完成",
        "role": "导师审核",
        "time": "2025-01-20 10:30:00"
      },
      {
        "status": "进行中",
        "role": "学院审核",
        "time": ""
      }
    ]
  }
]
```

## 页面状态更新

### 导师首页
- **待处理**：显示状态为"审核中"或"未提交"的申请
- **已处理**：显示状态为"审核通过"的申请

### 进站申请页面
- **流程状态**：根据workflow状态动态显示
- **节点名称**：显示当前负责审核的节点
- **当前审批结果**：显示具体的审核状态

### 流程图
- **学生申请**：提交后显示"已完成"
- **导师审核**：审核后显示"已完成"
- **学院审核**：根据实际状态显示

### 博士后页面
- 所有流程状态都会根据workflow状态同步更新
- 支持实时刷新查看最新状态

## 错误处理

### 常见错误
1. **权限不足**：只有导师可以审核申请
2. **学生不存在**：目标学生ID无效
3. **状态错误**：当前状态不允许审核操作

### 错误响应
```json
{
  "detail": "只有导师可以访问此接口"
}
```

## 测试建议

### 测试场景
1. **正常审核流程**：导师通过学生申请
2. **驳回流程**：导师驳回学生申请
3. **状态验证**：确认各页面状态同步更新
4. **权限测试**：非导师用户无法审核

### 测试步骤
1. 创建测试学生和导师账号
2. 学生提交申请
3. 导师登录进行审核
4. 验证各页面状态更新
5. 检查流程图状态变化

## 注意事项

1. **状态一致性**：确保所有页面的状态显示一致
2. **权限控制**：只有导师可以审核自己学生的申请
3. **数据完整性**：审核操作会更新workflow表
4. **用户体验**：提供清晰的状态反馈和错误提示 